---
title: "Climate Normal"
author: "Dr. Chih-Yu Hung"
date: "2024-05-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse); library(data.table)
```

## To prepare Climate normals

US Climate normal for temperature (degree C), precipitation (mm), potential evapotranspiration (mm) in 1981-2010.
The spatial scale is county and state. 
Original data: monthly data from 1981-2010. 

```{r read data}
Temp <- fread("Climate Normals/Temperature_perCounty.csv", header = TRUE)
Pre <- fread("Climate Normals/Precipitation_perCounty.csv")
#Pet <-
```


## Temperature data

Data need to be "State", "County", "Temp", "Temp_grow".
The "Temp" is the average annual temperature during 1981-2010 and the "Temp_grow" is the average temperature in growing season (May-October) during 1981-2010. 

```{r Temperature}
Temp <- Temp %>%
   separate(County_State, into = c("County", "State"), sep = " - ")

# Calculate the average of the 1981-2010
Temp$Temp <- rowMeans(Temp[, 3:362], na.rm = TRUE)

# Create the new table
US_Temp <- Temp %>% 
  select(County, State, Temp)


#Growing season 
column_names <- colnames(Temp) 
Growing_season <- column_names[grepl(".*(198[1-9]|199[0-9]|200[0-9]|2010).*(05|06|07|08|09|10)$", column_names)]

#Table with growing seasons
numeric_columns <- Temp %>% 
  select(all_of(Growing_season))

# Calculate the average of the numeric columns
US_Temp$Temp_grow <- rowMeans(numeric_columns, na.rm = TRUE)

```


## Precipitation data

Data need to be "State", "County", "Pre", "Pre_grow".
The "Pre" is the total annual Precipitation during 1981-2010 and the "Pre_grow" is the total precipitation in growing season (May-October) during 1981-2010. 

```{r Precipitation}
Pre <- Pre %>%
   separate(County_State, into = c("County", "State"), sep = " - ")

# Calculate the total annual precipitation of the 1981-2010
Pre$Pre <- rowSums(Pre[, 3:362], na.rm = TRUE)/30

# Create the new table
US_Pre <- Pre %>% 
  select(County, State, Pre)


#Growing season 
column_names <- colnames(Pre) 
Growing_season <- column_names[grepl(".*(198[1-9]|199[0-9]|200[0-9]|2010).*(05|06|07|08|09|10)$", column_names)]

#Table with growing seasons
numeric_columns <- Pre %>% 
  select(all_of(Growing_season))

# Calculate the average of the numeric columns
US_Pre$Pre_grow <- rowSums(numeric_columns, na.rm = TRUE)/30

```
